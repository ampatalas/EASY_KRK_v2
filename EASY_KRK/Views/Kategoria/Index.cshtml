@model EASY_KRK.Models.KategorieViewModel
@{
    ViewBag.Title = "Kategorie";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Kategorie</h2>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@Scripts.Render("~/bundles/jqueryval")
@Scripts.Render("~/bundles/jqueryui")

<link href="content/themes/base/all.css" rel="stylesheet" />
<script src="/Scripts/CollapsibleLists.js"></script>

<script type="text/javascript">
    $(document).ready(function() {
        CollapsibleLists.apply();

        $('form input').on('change', function() {
            var selected = $('input[name=IdKategorii]:checked', 'form').val();
            var url = "/Kategoria/StatusKategorii?IdKategorii=" + selected;

            var ajax = $.ajax({
                type: 'GET',
                url: "/Kategoria/StatusKategorii/",
                dataType: "json",
                data: { IdKategorii: selected },
                success: function (data) {
                    if (data.hasValue) {
                        $('#addCategory').prop('disabled', true);
                    }
                    else {
                        $('#addCategory').prop('disabled', false);
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(errorThrown);
                }
            });
        });
    });
</script>

@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

    <ul class="treeView">
        @foreach (var k in Model.Kategorie)
        {
            <li>
                @Html.RadioButtonFor(m => m.IdKategorii, k.IdKategorii)
                @Html.Label(k.NazwaKategorii)
            </li>
            @PokazDrzewo(k.Kategorie)
        }
    </ul>
    
    <input type="submit" value="Dodaj kategorię" name="Add" class="btn btn-default" id="addCategory" />
    <input type="submit" value="Edytuj kategorię" name="Edit" class="btn btn-default" />
    <input type="submit" value="Usuń kategorię" name="Delete" class="btn btn-default" onclick="return confirm('Czy na pewno chcesz usunąć przedmiot i wszystkie powiązane z nim kursy/grupy kursów?');" />

}

@helper PokazDrzewo(IEnumerable<EASY_KRK.Models.Kategoria> kategorie)
{
    <ul class="collapsibleList">
        @foreach (var kat in kategorie)
        {
            <li>
                @Html.RadioButtonFor(m => m.IdKategorii, kat.IdKategorii)
                @Html.Label(kat.NazwaKategorii)
                @if (kat.MinECTS.HasValue)
                {
                    @Html.Label("(min " + kat.MinECTS + " ECTS)")
                }
                @if (kat.Kategorie.Any())
                {
                    @PokazDrzewo(kat.Kategorie)
                }
                else
                {
                    if (kat.Przedmioty.Any())
                    {
                        <a href=""><br />Zarządzaj przedmiotami</a>
                    }
                }
            </li>
        }
    </ul>
}

